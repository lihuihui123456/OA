function carousel_sortable(){
	$('.carousel-item').sortable({
		appendTo: 'body' ,
		cancel: '.flag-inner-temp',
		scroll: false,
		connectWith:"#trash,#trash1",
		containment:'body',
		forceHelperSize:true,
		
		zIndex: 9999,
		tolerance: "touch",
		activate: function(event, ui) {
			//$( ui.helper ).css({"zIndex":'999999'});
			//$(ui.item).remove();
			

		},
		deactivate: function( event, ui ) {
			//alert(111);
			$(ui.item.context).css({"height":'100%',"width":'100%'});
		},
		sort: function(event, ui) {
		},
		remove:function(event,ui){
	    	//alert("remove");
	    	var info = $(ui.item).data("ds");
	    	var ds=$(this).children(".carousel-item-div").data("ds");
	    	var warp=$(this);
			 $.ajax({
				url: 'themeController/updateModule',
				data:{UserRefThemeInfoId:info.id},
				dataType: 'json',
				async: false,
				cache:false,
				success: function(result) {
					//alert("删除成功");
					warp.empty();
					var setting = $.extend({}, result, _cache.windowTemp);
					var win_Inner=$(FormatModel(Circleinner, setting));
					win_Inner.data("ds",setting);
                    warp.append(win_Inner);
                    $(ui.helper).remove();
				},
				error: function(result) {
					layerMsg("该应用已经添加，请您重新选择！");
					$('#icon_wrap_ul').sortable("cancel");
				}
			});
		},
		receive:function(event,ui){
			//alert("receive");
			var warp=$(this);
			var info = $(ui.item).data("info");
			if(info==null){
				info = $(ui.item).data("ds");
				var info2 = warp.children(".carousel-item-div").data("ds");
	            $.ajax({
	                url: 'themeController/setFusionUp',
	                data:{modId:info.modId,UserRefThemeInfoId2:info2.id},
	                dataType: 'json',
	                async: false,
	                cache:false,
	                success: function(res) {
	                  	if(res==null){
	           	    	    layerMsg("该应用已经添加，请您重新选择！");
	           	    	    return;
			            }else{
							var setting = $.extend({}, res, _cache.windowTemp);
							var win_Inner=$(FormatModel(windowWorkCircleInner, setting));
							win_Inner.data("ds",setting);
							warp.empty();
	                        warp.append(win_Inner);
	                        handleCircle(warp);
	                        $(ui.item).remove();
	               		}
	                },
	                error: function(result) {
	                   layerMsg("该应用已经添加，请您重新选择！");
	                    }
	                });
				
			}else{
				var ds=$(this).children(".carousel-item-div").data("ds");
	            $.ajax({
	                url: 'themeController/updateFusionDesktop',
	                data:{id:ds.id,modId:info.id},
	                dataType: 'json',
	                async: false,
	                cache:false,
	                success: function(res) {
	                  	if(res==null){
	                  		$(ui.helper).remove();
	           	    	    layerMsg("该应用已经添加，请您重新选择！");
	           	    	    return;
			            }else{
							var setting = $.extend({}, res, _cache.windowTemp);
							var win_Inner=$(FormatModel(windowWorkCircleInner, setting));
							//warp.data("ds", setting);
							win_Inner.data("ds",setting);
							warp.empty();
	                        warp.append(win_Inner);
	                        handleCircle(warp);
	                        //$(ui.item).remove();
	               		}
	                },
	                error: function(result) {
	                   layerMsg("该应用已经添加，请您重新选择！");
	                    }
	                });
			}

		
		},
		helper:function(event,ui){
			var ds=$(this).children(".carousel-item-div").data("ds");
			var lio = $(FormatModel(navigationLi, ds));
			var str = lio.find(".ospan").text();
			lio.find(".ospan").text(calStr(str));
			lio.data("ds", ds);
			lio.css({"height":'60px',"width":'60px'});
			$(ui.context).css({"height":'60px',"width":'60px'});
			$( '.carousel-item' ).sortable( "option", "cursorAt", { top:20 ,left: 20} );
            return lio;
		}
	});
}

jQuery(document).ready(function($){
	$('#trash1').sortable({
		containment:"body",
        tolerance: "touch",
        zIndex: 9999999,
        receive:function(event, ui){
        	var modId=null;
        	var pageId=null;
            var info = $(ui.item).data("info");
            if(info==undefined){
            	var ds = $(ui.item).data("ds");
            	modId=ds.modId;
            	pageId=ds.pageId;
            	
                $.ajax({
                    url: 'themeController/setFusionDown',
                    data:{modId:modId,pageId:pageId,UserRefThemeInfoId:ds.id},
                    dataType: 'json',
                    async: false,
                    cache:false,
                    success: function(res) {
	                  	if(res==null){
               	    	    layerMsg("该应用已经添加，请您重新选择！");
               	    	    return;
			            }else{
			            	$(ui.item).remove();
							var setting = $.extend({}, res, _cache.windowTemp);
							var lio = $(FormatModel(navigationLi, setting));
							var str = lio.find(".ospan").text();
							lio.find(".ospan").text(calStr(str));
							lio.data("ds", setting);
							$("#icon_wrap_ul").append(lio);
							handleClick(lio);
	               		}
                    },
                    error: function(result) {
                       layerMsg("该应用已经添加，请您重新选择！");
                        }
                    });
            }else{

				var ds=$(this).children(".carousel-item-div").data("ds");
	            $.ajax({
	                url: 'themeController/updateFusionDesktop',
	                data:{id:ds.id,modId:info.id},
	                dataType: 'json',
	                async: false,
	                cache:false,
	                success: function(res) {
	                  	if(res==null){
	                  		$(ui.helper).remove();
	           	    	    layerMsg("该应用已经添加，请您重新选择！");
	           	    	    return;
			            }else{
							var setting = $.extend({}, res, _cache.windowTemp);
							var win_Inner=$(FormatModel(windowWorkCircleInner, setting));
							//warp.data("ds", setting);
							win_Inner.data("ds",setting);
							warp.empty();
	                        warp.append(win_Inner);
	                        handleCircle(warp);
	                        //$(ui.item).remove();
	               		}
	                },
	                error: function(result) {
	                   layerMsg("该应用已经添加，请您重新选择！");
	                    }
	                });
			
            }
        },
        activate:function(){
			$('#trash1').css("background-image","url(views/cap/isc/theme/fusion/images/add3.png)");
			$('#trash1').css("display","block");
			$('#trash1').css("z-index",99999);
        },
        deactivate:function(){
			$('#trash1').css("background-image","");
			
        }
	});
	$('#trash').sortable({
		containment:"body",
        tolerance: "touch",
        zIndex: 9999999,
        receive:function(event, ui){
        	$(ui.item).remove();
        },
        activate:function(){
			$('#trash').css("background-image","url(views/cap/isc/theme/fusion/images/trash_s.png)");
			$('#trash').css("display","block");
			$('#trash').css("z-index",99999);
        },
        deactivate:function(){
			$('#trash').css("background-image","");
			
        }
	});
	 
	 $('#icon_wrap_ul').sortable({
	     tolerance: "touch",
		 connectWith:"#trash,#carousel >div",
		 containment:document.body,
		 zIndex: 9999,
		 remove:function(e){
	     },
	     
		 deactivate: function( event, ui ) {
			$(ui.item.context).css({"height":'60px',"width":'60px'});
		 },
	     
	     
	     sort: function(event, ui) {
	     	var bodyHeight = document.body.clientHeight;
	     	if(event.y > bodyHeight){
	     		return false;
	     	}
	     	var bodyWidth = document.body.clientWidth;
	     	if(event.x > bodyWidth){
	     		return false;
	     	}
	     },
	     receive: function( event, ui ) {
	    	//alert("receive");
	        $(ui.helper).remove();
	        var foot_icon_list=$('#icon_wrap_ul').sortable("toArray");
	        //alert(foot_icon_list.length);
	        if(foot_icon_list.length>9){
	           layerMsg("导航栏应用个数大于9，请删除后再添加！");
	        }else{
	        	var modId=null;
	        	var pageId=null;
                var info = $(ui.item).data("info");
                if(info==undefined){
                	var ds = $(ui.item).data("ds");
                	modId=ds.modId;
                	pageId=ds.pageId;
                	
                    $.ajax({
                        url: 'themeController/setFusionDown',
                        data:{modId:modId,pageId:pageId,UserRefThemeInfoId:ds.id},
                        dataType: 'json',
                        async: false,
                        cache:false,
                        success: function(res) {
    	                  	if(res==null){
                   	    	    layerMsg("该应用已经添加，请您重新选择！");
                   	    	    return;
    			            }else{
    			            	$(ui.item).remove();
    							var setting = $.extend({}, res, _cache.windowTemp);
    							var lio = $(FormatModel(navigationLi, setting));
    							var str = lio.find(".ospan").text();
    							lio.find(".ospan").text(calStr(str));
    							lio.data("ds", setting);
    							$("#icon_wrap_ul").append(lio);
    							handleClick(lio);
    	               		}
                        },
                        error: function(result) {
                           layerMsg("该应用已经添加，请您重新选择！");
                            }
                        });
                }else{
                	modId=info.id;
                	pageId="nav11"
                    $.ajax({
                        url: 'themeController/setFusionDesktop',
                        data:{modId:modId,pageId:pageId},
                        dataType: 'json',
                        async: false,
                        cache:false,
                        success: function(res) {
    	                  	if(res==null){
                   	    	    layerMsg("该应用已经添加，请您重新选择！");
                   	    	    return;
    			            }else{
    							//$(ui.item).remove();
    							ui.item= null;
    							var setting = $.extend({}, res, _cache.windowTemp);
    							var lio = $(FormatModel(navigationLi, setting));
    							var str = lio.find(".ospan").text();
    							lio.find(".ospan").text(calStr(str));
    							lio.data("ds", setting);
    							$("#icon_wrap_ul").append(lio);
    							handleClick(lio);
                        	    
    	               		}
                        },
                        error: function(result) {
                           layerMsg("该应用已经添加，请您重新选择！");
                        }
                    });
                }

	        };
	     },
	
	    update: function( event, ui ) {
	    	//alert("update");
	    },
	    
	    remove:function(event,ui){
	    	//alert("remove");
	    	var info = $(ui.item).data("ds");
			 $.ajax({
				url: 'themeController/deleteModule',
				data:{UserRefThemeInfoId:info.id},
				dataType: 'json',
				async: false,
				cache:false,
				success: function(result) {
					//$(ui.item).remove();
				},
				error: function(result) {
					layerMsg("该应用已经添加，请您重新选择！");
					$('#icon_wrap_ul').sortable("cancel");
				}
			});
	    }
	    
	 });
});
